#!/bin/bash
#
# THIS SCRIPT IS CRUCIAL FOR AN LG IMAGE
# 
# performing git checkout as root leaves us with
# a lot of root-owned files that need to be adjusted
# in order to have proper functionality.

## try using the git bash_completion functions
. /etc/bash_completion.d/git 2>/dev/null
gitdir=$(__git_dir 2>/dev/null)

## fallback
# assumption: the git directory is in the root of the filesystem
# BUT we do not assume the root of the filesystem is "/" - we may be 
# a chroot dir or similar, being manipulated prior to 'chroot'.
GIT_DIR="${gitdir:-$( dirname $0 )/../../.git}"

LOG_FILE=/tmp/git-hook.log
function log {
    echo "$@" | tee -a ${LOG_FILE}
}

log "prev_head_ref = $1"
log "new_head_ref = $2"
log "branch_flag = $3"
log "git_dir = ${GIT_DIR}"

LG_HOME="${GIT_DIR}/../home/lg"
log "chown -vR lg: ${LG_HOME}"
ls -l ${LG_HOME}
